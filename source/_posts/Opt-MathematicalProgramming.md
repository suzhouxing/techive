---
title: 数学规划基础
date: 2019-01-13 11:14:16
categories:
- 技术
tags:
- 建模
- 优化
- 技术
- 数学
---
面对一个复杂的组合优化问题, 把它描述清楚本身就不是一个简单的问题.
常规开发往往允许模棱两可的描述, 需求修修补补虽然很烦, 但往往只是工作量的问题.
而算法研发由于其专用性, 细微的需求变化可能导致一个算法完全失效, 除非重新设计整个框架不然无法解决新的问题.
所以, 严谨的需求分析或问题描述对于算法研发格外重要.
对于一个组合优化问题, 我们一般使用数学规划的形式化语言对其进行无二义性的定义, 作为算法工程中的需求分析文档.



# 线性规划与混合整数规划

## 思维方式

### 已知

- 约束和目标中的系数

### 决策

- 确定哪些可控因素需要做决策
  - 定义域
    - 布尔 / 整数 / 实数
    - 上界 / 下界
- 从最根本的需求开始
  - 显示决策 (根本需求)
  - 隐式决策 (客户不关心但十分重要)
  - 辅助决策 (将非线性约束转化为线性约束)
- 不够用再返回来补充

### 约束

- 决策变量组成的表达式满足的关系
  - 等式或不等式 $f(x) ? g(x)$
  - 下标的取值范围 $\forall i \in V$
- 可以和目标对调顺序, 谁简单先考虑谁
- 如何验证约束是否完备?
  - 经验?
  - 详尽的测试?
  - ...

### 目标

- 不同决策变量取值组合产生的后果

### 思考问题的角度 (决策变量的设置)

- 图着色问题
  - 每个节点染什么颜色
  - 每种颜色的节点集合包含了哪些节点
  - 每两个节点是否染了相同的颜色
- 布尔表达式可满足性问题
  - 保证每个布尔变量在所有子句中取值一致，最大化为真的子句数量
  - 保证每个子句均为真，最大化布尔变量的一致性


## 编程实现

### 求解器选择

- [Gurobi](http://www.gurobi.com/)
  - 目前最高效的线性规划/混合整数规划求解器
  - 支持免费学术许可证申请
- [CPLEX](https://www.ibm.com/software/commerce/optimization/cplex-optimizer/)
  - IBM旗下的 "行业标准"
- [SCIP](http://scip.zib.de/)
  - 号称最快的开源求解器
- [COIN-OR](https://projects.coin-or.org/Cbc)
  - 功能繁多的开源运筹学工具包
- [or-tools](https://github.com/google/or-tools)
  - 开源经典组合优化算法库
  - 提供统一的接口调用各大常见求解器

### 接口选择

- 编程语言接口
  - 开发中最常用的接口
  - 提供更高层次的抽象
  - 更快的模型构建速度
  - C / C++ / Java / C# / Python / Matlab / R
- 模型文件接口
  - 需要自己将模型展开为线性规划的标准型
  - 文件 I/O 速度较慢
- 交互式命令行接口 (Gurobi)
  - 类似于解释型的脚本语言
- OPLIDE (CPLEX)
  - 介于命令式语言与建模语言之间
- Excel 插件
- ...

### 使用编程语言接口的求解过程 (Gurobi)

参考自带的示例工程 diet, facility, mip1.
基本流程如下.

- 初始化环境 GRBEnv()
  - 反盗版
  - 其他全局数据
- 初始化模型 GRBModel()
- 添加决策变量 GRBModel::addVar()
  - 按照一定规律组织决策变量
  - 使用额外的数据结构将决策变量与用户变量绑定
- 更新模型 GRBModel::update()
  - 惰性更新提升效率
  - CPLEX 不需要此步骤
- 设置目标 GRBModel::setObjective()
- 添加约束 GRBModel::addConstr()
- 设置其他参数 GRBModel::set(), GRBEnv::set()
  - 运行时间
  - 输出日志
- 求解 GRBModel::optimize()
- 检查求解状态 GRBModel::get(GRB_IntAttr_Status)
- 获取目标函数值 GRBModel::get(GRB_DoubleAttr_ObjVal)
- 获取解向量 GRBVar::get()

### 使用模型文件接口的求解过程 (Gurobi)

参考自带的示例工程 lp.
基本流程如下.

- 准备好 .mps 或 .lp 等模型文件 GRBModel::write()
  - 一般由另外的程序输出
- 读取模型文件 GRBModel(), GRBModel::read()
- 求解并输出
